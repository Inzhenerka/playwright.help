---
id: test-typescript
title: "TypeScript"
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HTMLCard from '@site/src/components/HTMLCard';

## Введение

Playwright поддерживает TypeScript из коробки. Вы просто пишете тесты на TypeScript, а Playwright читает их, преобразует в JavaScript и выполняет.

Обратите внимание, что Playwright не проверяет типы и будет выполнять тесты даже в случае наличия некритических ошибок компиляции TypeScript. Мы рекомендуем запускать компилятор TypeScript вместе с Playwright. Например, в GitHub Actions:

```yaml
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    ...
    - name: Запуск проверки типов
      run: npx tsc -p tsconfig.json --noEmit
    - name: Запуск тестов Playwright
      run: npx playwright test
```

Для локальной разработки вы можете запустить `tsc` в [режиме наблюдения](https://www.typescriptlang.org/docs/handbook/configuring-watch.html) следующим образом:

```sh
npx tsc -p tsconfig.json --noEmit -w
```

## tsconfig.json

Playwright будет использовать `tsconfig.json` для каждого загружаемого исходного файла. Обратите внимание, что Playwright **поддерживает только** следующие параметры tsconfig: `allowJs`, `baseUrl`, `paths` и `references`.

Мы рекомендуем настроить отдельный `tsconfig.json` в директории тестов, чтобы вы могли изменить некоторые параметры специально для тестов. Вот пример структуры директорий.

```txt
src/
    source.ts

tests/
    tsconfig.json  # tsconfig, специфичный для тестов
    example.spec.ts

tsconfig.json  # общий tsconfig для всех исходников TypeScript

playwright.config.ts
```

### Сопоставление путей в tsconfig

Playwright поддерживает [сопоставление путей](https://www.typescriptlang.org/docs/handbook/module-resolution.html#path-mapping), объявленное в `tsconfig.json`. Убедитесь, что `baseUrl` также установлен.

Вот пример `tsconfig.json`, который работает с Playwright:

```json title="tsconfig.json"
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@myhelper/*": ["packages/myhelper/*"] // Это сопоставление относительно "baseUrl".
    }
  }
}
```

Теперь вы можете импортировать, используя сопоставленные пути:

```js title="example.spec.ts"
import { test, expect } from '@playwright/test';
import { username, password } from '@myhelper/credentials';

test('example', async ({ page }) => {
  await page.getByLabel('User Name').fill(username);
  await page.getByLabel('Password').fill(password);
});
```

### Разрешение tsconfig

По умолчанию Playwright будет искать ближайший tsconfig для каждого импортированного файла, поднимаясь по структуре директорий и ища `tsconfig.json` или `jsconfig.json`. Таким образом, вы можете создать файл `tests/tsconfig.json`, который будет использоваться только для ваших тестов, и Playwright автоматически его подберет.

```sh
# Playwright автоматически выберет tsconfig
npx playwright test
```

В качестве альтернативы вы можете указать один tsconfig файл для использования в командной строке, и Playwright будет использовать его для всех импортированных файлов, а не только для тестовых файлов.

```sh
# Указать конкретный tsconfig
npx playwright test --tsconfig=tsconfig.test.json
```

Вы можете указать один tsconfig файл в конфигурационном файле, который будет использоваться для загрузки тестовых файлов, репортеров и т.д. Однако он не будет использоваться при загрузке самого конфигурационного файла playwright или любых файлов, импортированных из него.

```js title="playwright.config.ts"
import { defineConfig } from '@playwright/test';

export default defineConfig({
  tsconfig: './tsconfig.test.json',
});
```

## Ручная компиляция тестов с TypeScript

Иногда Playwright Test не сможет правильно преобразовать ваш код на TypeScript, например, когда вы используете экспериментальные или очень новые функции TypeScript, обычно настраиваемые в `tsconfig.json`.

В этом случае вы можете выполнить собственную компиляцию TypeScript перед отправкой тестов в Playwright.

Сначала добавьте файл `tsconfig.json` в директорию тестов:

```json
{
    "compilerOptions": {
        "target": "ESNext",
        "module": "commonjs",
        "moduleResolution": "Node",
        "sourceMap": true,
        "outDir": "../tests-out",
    }
}
```

В `package.json` добавьте два скрипта:

```json
{
  "scripts": {
    "pretest": "tsc --incremental -p tests/tsconfig.json",
    "test": "playwright test -c tests-out"
  }
}
```

Скрипт `pretest` запускает TypeScript на тестах. `test` будет запускать тесты, которые были сгенерированы в директории `tests-out`. Аргумент `-c` настраивает тестовый раннер на поиск тестов внутри директории `tests-out`.

Теперь команда `npm run test` соберет тесты и запустит их.