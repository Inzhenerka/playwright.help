---
id: debug
title: "Отладка тестов"
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HTMLCard from '@site/src/components/HTMLCard';

## Отладчик VS Code

Мы рекомендуем использовать [расширение VS Code](./getting-started-vscode.mdx) для отладки, чтобы улучшить опыт разработки. С помощью расширения VS Code вы можете отлаживать свои тесты прямо в VS Code, видеть сообщения об ошибках, устанавливать точки останова и пошагово проходить тесты.

<img width="1269" alt="running test in debug mode" src="https://user-images.githubusercontent.com/13063165/212740233-3f278825-13e7-4a88-a118-dd4478d43a16.png" />

### Сообщения об ошибках

Если ваш тест не проходит, VS Code покажет вам сообщения об ошибках прямо в редакторе, указывая, что ожидалось, что было получено, а также полный журнал вызовов.

<img width="1269" alt="error messaging in vs code" src="https://user-images.githubusercontent.com/13063165/212738654-b573b7c9-05be-476f-ab4c-201bf4265bc0.png" />

### Живая отладка

Вы можете отлаживать свой тест в реальном времени в VS Code. После запуска теста с установленным флажком `Show Browser`, щелкните по любому из локаторов в VS Code, и он будет выделен в окне браузера. Playwright также покажет вам, если есть несколько совпадений.

<img width="1394" alt="live debugging in VS Code" src="https://user-images.githubusercontent.com/13063165/212884329-0755b007-0d69-4987-b084-38fd5bfb577d.png" />

Вы также можете редактировать локаторы в VS Code, и Playwright покажет вам изменения в реальном времени в окне браузера.

<img width="1394" alt="live debugging in VS Code" src="https://user-images.githubusercontent.com/13063165/212884772-5022d4b1-6fab-456f-88e3-506f2354e238.png" />

### Выбор локатора

Выберите [локатор](./locators.mdx) и скопируйте его в файл теста, нажав кнопку **Pick locator** в боковой панели тестирования. Затем в браузере щелкните по элементу, который вам нужен, и он появится в поле **Pick locator** в VS Code. Нажмите 'enter' на клавиатуре, чтобы скопировать локатор в буфер обмена, а затем вставьте его в любом месте вашего кода. Или нажмите 'escape', если хотите отменить.

<img width="1394" alt="Pick locators" src="https://user-images.githubusercontent.com/13063165/212741666-6479a702-2517-44a3-9eca-e719e13b379c.png" />

Playwright проанализирует вашу страницу и определит лучший локатор, приоритизируя [локаторы по роли, тексту и идентификатору теста](./locators.mdx). Если Playwright находит несколько элементов, соответствующих локатору, он улучшит локатор, чтобы сделать его устойчивым и уникально идентифицировать целевой элемент, так что вам не придется беспокоиться о неудачных тестах из-за локаторов.

### Запуск в режиме отладки

Чтобы установить точку останова, щелкните рядом с номером строки, где вы хотите, чтобы точка останова была установлена, пока не появится красная точка. Запустите тесты в режиме отладки, щелкнув правой кнопкой мыши на строке рядом с тестом, который вы хотите запустить.

<img width="1269" alt="setting debug test mode" src="https://user-images.githubusercontent.com/13063165/212739847-ecb7dcfe-8929-45f3-b24e-f9c4b592f430.png" />

Откроется окно браузера, и тест будет запущен и приостановлен в месте, где установлена точка останова. Вы можете пошагово проходить тесты, приостанавливать тест и повторно запускать тесты из меню в VS Code.

<img width="1269" alt="running test in debug mode" src="https://user-images.githubusercontent.com/13063165/212740233-3f278825-13e7-4a88-a118-dd4478d43a16.png" />

### Отладка в разных браузерах

По умолчанию отладка выполняется с использованием профиля Chromium. Вы можете отлаживать свои тесты в разных браузерах, щелкнув правой кнопкой мыши на значке отладки в боковой панели тестирования и выбрав опцию 'Select Default Profile' из выпадающего меню.

<img width="1312" alt="debugging on specific profile" src="https://user-images.githubusercontent.com/13063165/212879469-436f8130-c62a-49e1-9d67-c1903b478d5f.png" />

Затем выберите тестовый профиль, который вы хотите использовать для отладки своих тестов. Каждый раз, когда вы запускаете тест в режиме отладки, он будет использовать выбранный вами профиль. Вы можете запускать тесты в режиме отладки, щелкнув правой кнопкой мыши на номере строки, где находится ваш тест, и выбрав 'Debug Test' из меню.

<img width="1312" alt="choosing a profile for debugging" src="https://user-images.githubusercontent.com/13063165/212880198-eac22c3e-68ce-47da-9163-d6b376ae7575.png" />

Чтобы узнать больше об отладке, смотрите [Отладка в Visual Studio Code](https://code.visualstudio.com/docs/editor/debugging).

## Playwright Inspector

Playwright Inspector — это графический инструмент, который помогает вам отлаживать ваши тесты Playwright. Он позволяет вам пошагово проходить ваши тесты, вносить изменения в локаторы в реальном времени, выбирать локаторы и видеть журналы действия.

<img width="864" alt="Playwright Inspector" src="https://user-images.githubusercontent.com/13063165/212924587-4b84e5f6-b147-40e9-8c75-d7b9ab6b7ca1.png" />

### Запуск в режиме отладки

Запустите свои тесты с флагом `--debug`, чтобы открыть инспектор. Это настраивает Playwright для отладки и открывает инспектор. Дополнительные полезные параметры настраиваются, когда используется `--debug`:
- Браузеры запускаются в обычном режиме
- Значение по умолчанию для таймаута устанавливается в 0 (= без таймаута)

#### Отладка всех тестов во всех браузерах

Чтобы отладить все тесты, выполните команду тестирования с флагом `--debug`. Это будет запускать тесты по одному и открывать инспектор и окно браузера для каждого теста.

```bash
npx playwright test --debug
```

#### Отладка одного теста во всех браузерах

Чтобы отладить один тест на определенной строке, выполните команду тестирования, за которой следует имя файла теста и номер строки теста, который вы хотите отладить, за которым следует флаг `--debug`. Это запустит один тест в каждом браузере, настроенном в вашем [`playwright.config`](./test-projects.mdx#configure-projects-for-multiple-browsers), и откроет инспектор.

```bash
npx playwright test example.spec.ts:10 --debug
```

#### Отладка в конкретном браузере

В Playwright вы можете настраивать проекты в вашем [`playwright.config`](./test-projects.mdx#configure-projects-for-multiple-browsers). После настройки вы можете отлаживать свои тесты в конкретном браузере или мобильном представлении, используя флаг `--project`, за которым следует имя проекта, настроенного в вашем `playwright.config`.

```bash
npx playwright test --project=chromium --debug
npx playwright test --project="Mobile Safari" --debug
npx playwright test --project="Microsoft Edge" --debug
```

#### Отладка одного теста в конкретном браузере

Чтобы запустить один тест в конкретном браузере, добавьте имя файла теста и номер строки теста, который вы хотите отладить, а также флаг `--project`, за которым следует имя проекта.

```bash
npx playwright test example.spec.ts:10 --project=webkit --debug
```

### Пошаговое выполнение тестов

Вы можете воспроизводить, приостанавливать или пошагово проходить каждое действие вашего теста, используя панель инструментов в верхней части инспектора. Вы можете видеть текущее действие, выделенное в коде теста, и соответствующие элементы, выделенные в окне браузера.

<img width="1340" alt="Playwright Inspector and browser" src="https://user-images.githubusercontent.com/13063165/212936618-84b87acc-bc2e-46ed-994b-32b2ef742e60.png" />

### Запуск теста с конкретной точки останова

Чтобы ускорить процесс отладки, вы можете добавить метод [page.pause()](/api/class-page.mdx#page-pause) в ваш тест. Таким образом, вам не придется проходить каждое действие вашего теста, чтобы добраться до точки, где вы хотите отладить.

```js
await page.pause();
```

После того как вы добавите вызов `page.pause()`, запустите свои тесты в режиме отладки. Нажатие кнопки "Resume" в инспекторе запустит тест и остановится только на `page.pause()`.

<img width="1350" alt="test with page.pause" src="https://user-images.githubusercontent.com/13063165/219473050-122be4c2-31d0-4cbd-aa8b-8588e8b781a6.png" />

### Живое редактирование локаторов

Во время работы в режиме отладки вы можете вносить изменения в локаторы в реальном времени. Рядом с кнопкой 'Pick Locator' есть поле, показывающее [локатор](./locators.mdx), на котором тест приостановлен. Вы можете редактировать этот локатор непосредственно в поле **Pick Locator**, и соответствующие элементы будут выделены в окне браузера.

<img width="1348" alt="live editing locators" src="https://user-images.githubusercontent.com/13063165/212980815-1cf6ef7b-e69a-496c-898a-ec603a3bc562.png" />

### Выбор локаторов

Во время отладки вам может понадобиться выбрать более устойчивый локатор. Вы можете сделать это, нажав кнопку **Pick Locator** и наведя курсор на любой элемент в окне браузера. При наведении на элемент вы увидите код, необходимый для его локализации, выделенный ниже. Щелчок по элементу в браузере добавит локатор в поле, где вы можете либо изменить его, либо скопировать в свой код.

<img width="1392" alt="Picking locators" src="https://user-images.githubusercontent.com/13063165/212968640-ce82a027-9277-4bdf-b0a9-6282fb2becb7.png" />

Playwright проанализирует вашу страницу и определит лучший локатор, приоритизируя [локаторы по роли, тексту и идентификатору теста](./locators.mdx). Если Playwright находит несколько элементов, соответствующих локатору, он улучшит локатор, чтобы сделать его устойчивым и уникально идентифицировать целевой элемент, так что вам не придется беспокоиться о неудачных тестах из-за локаторов.

### Журналы действия

К моменту, когда Playwright приостановил выполнение на действии клика, он уже выполнил [проверки действия](./actionability.mdx), которые можно найти в журнале. Это может помочь вам понять, что произошло во время вашего теста и что Playwright сделал или пытался сделать. Журнал сообщает, был ли элемент видим, активен и стабилен, разрешился ли локатор в элемент, прокрутился ли он в видимую область и многое другое. Если действие не может быть выполнено, оно будет отображаться как ожидающее.

<img width="883" alt="Actionability Logs" src="https://user-images.githubusercontent.com/13063165/212968907-5dede739-e0e3-482a-91cd-726a0f5b0b6d.png" />

## Просмотр трасс

Playwright [Trace Viewer](/trace-viewer.mdx) — это графический инструмент, который позволяет вам исследовать записанные трассы Playwright ваших тестов. Вы можете перемещаться вперед и назад по каждому действию с левой стороны и визуально видеть, что происходило во время действия. В середине экрана вы можете видеть снимок DOM для действия. Справа вы можете видеть детали действия, такие как время, параметры, возвращаемое значение и журнал. Вы также можете исследовать сообщения консоли, сетевые запросы и исходный код.

<video width="100%" height="100%" controls muted>

<source src="https://user-images.githubusercontent.com/13063165/219132713-17b9d75b-71e3-42c4-a43f-3f9e2e15f834.mp4" type="video/mp4" /> Ваш браузер не поддерживает тег видео.

</video>

Чтобы узнать больше о том, как записывать трассы и использовать Trace Viewer, ознакомьтесь с руководством [Trace Viewer](/trace-viewer.mdx).

## Инструменты разработчика браузера

При запуске в режиме отладки с `PWDEBUG=console` объект `playwright` доступен в консоли инструментов разработчика. Инструменты разработчика могут помочь вам:
- Исследовать дерево DOM и **находить селекторы элементов**
- **Просматривать журналы консоли** во время выполнения (или узнать, как [читать журналы через API](./api/class-page.mdx#page-event-console))
- Проверять **сетевую активность** и другие функции инструментов разработчика

Это также установит значения по умолчанию для таймаутов Playwright в 0 (= без таймаута).

<img width="1399" alt="Browser Developer Tools with Playwright object" src="https://user-images.githubusercontent.com/13063165/219128002-898f604d-9697-4b7f-95b5-a6a8260b7282.png" />

Чтобы отлаживать свои тесты с помощью инструментов разработчика браузера, начните с установки точки останова в вашем тесте, чтобы приостановить выполнение, используя метод [page.pause()](/api/class-page.mdx#page-pause).

```js
await page.pause();
```

После того как вы установили точку останова в вашем тесте, вы можете запустить тест с `PWDEBUG=console`.

<Tabs
  groupId="bash-flavor"
  defaultValue="bash"
  values={[
    {label: 'Bash', value: 'bash'},
    {label: 'PowerShell', value: 'powershell'},
    {label: 'Batch', value: 'batch'}
  ]
}>
<TabItem value="bash">

```bash
PWDEBUG=console npx playwright test
```

</TabItem>
<TabItem value="powershell">

```powershell
$env:PWDEBUG="console"
npx playwright test
```

</TabItem>
<TabItem value="batch">

```batch
set PWDEBUG=console
npx playwright test
```

</TabItem>
</Tabs>

После того как Playwright запустит окно браузера, вы можете открыть инструменты разработчика. Объект `playwright` будет доступен в панели консоли.

#### playwright.$(selector)

Запросите селектор Playwright, используя фактический движок запросов Playwright, например:

```bash
playwright.$('.auth-form >> text=Log in');

<button>Log in</button>
```

#### playwright.$$(selector)

То же самое, что и `playwright.$`, но возвращает все совпадающие элементы.

```bash
playwright.$$('li >> text=John')

[<li>, <li>, <li>, <li>]
```

#### playwright.inspect(selector)

Показать элемент в панели элементов.

```bash
playwright.inspect('text=Log in')
```

#### playwright.locator(selector)

Создайте локатор и запросите совпадающие элементы, например:

```bash
playwright.locator('.auth-form', { hasText: 'Log in' });

Locator ()
  - element: button
  - elements: [button]
```

#### playwright.selector(element)

Генерирует селектор для данного элемента. Например, выберите элемент в панели элементов и передайте `$0`:

```bash
playwright.selector($0)

"div[id="glow-ingress-block"] >> text=/.*Hello.*/"
```

## Подробные журналы API

Playwright поддерживает подробное ведение журналов с помощью переменной окружения `DEBUG`.

<Tabs
  groupId="bash-flavor"
  defaultValue="bash"
  values={[
    {label: 'Bash', value: 'bash'},
    {label: 'PowerShell', value: 'powershell'},
    {label: 'Batch', value: 'batch'}
  ]
}>
<TabItem value="bash">

```bash
DEBUG=pw:api npx playwright test
```

</TabItem>
<TabItem value="powershell">

```powershell
$env:DEBUG="pw:api"
npx playwright test
```

</TabItem>
<TabItem value="batch">

```batch
set DEBUG=pw:api
npx playwright test
```

</TabItem>
</Tabs>

:::note

**Для WebKit**: запуск WebKit Inspector во время выполнения предотвратит дальнейшее выполнение скрипта Playwright и сбросит предварительно настроенный пользовательский агент и эмуляцию устройства.
:::

## Обычный режим

Playwright по умолчанию запускает браузеры в безголовом режиме. Чтобы изменить это поведение, используйте `headless: false` в качестве параметра запуска.

Вы также можете использовать опцию [slowMo](/api/class-browsertype.mdx#browser-type-launch-option-slow-mo), чтобы замедлить выполнение (на N миллисекунд за операцию) и следить за процессом отладки.

```js
// Chromium, Firefox или WebKit
await chromium.launch({ headless: false, slowMo: 100 });
```


[Accessibility]: /api/class-accessibility.mdx "Accessibility"
[Android]: /api/class-android.mdx "Android"
[AndroidDevice]: /api/class-androiddevice.mdx "AndroidDevice"
[AndroidInput]: /api/class-androidinput.mdx "AndroidInput"
[AndroidSocket]: /api/class-androidsocket.mdx "AndroidSocket"
[AndroidWebView]: /api/class-androidwebview.mdx "AndroidWebView"
[APIRequest]: /api/class-apirequest.mdx "APIRequest"
[APIRequestContext]: /api/class-apirequestcontext.mdx "APIRequestContext"
[APIResponse]: /api/class-apiresponse.mdx "APIResponse"
[APIResponseAssertions]: /api/class-apiresponseassertions.mdx "APIResponseAssertions"
[Browser]: /api/class-browser.mdx "Browser"
[BrowserContext]: /api/class-browsercontext.mdx "BrowserContext"
[BrowserServer]: /api/class-browserserver.mdx "BrowserServer"
[BrowserType]: /api/class-browsertype.mdx "BrowserType"
[CDPSession]: /api/class-cdpsession.mdx "CDPSession"
[Clock]: /api/class-clock.mdx "Clock"
[ConsoleMessage]: /api/class-consolemessage.mdx "ConsoleMessage"
[Coverage]: /api/class-coverage.mdx "Coverage"
[Dialog]: /api/class-dialog.mdx "Dialog"
[Download]: /api/class-download.mdx "Download"
[Electron]: /api/class-electron.mdx "Electron"
[ElectronApplication]: /api/class-electronapplication.mdx "ElectronApplication"
[ElementHandle]: /api/class-elementhandle.mdx "ElementHandle"
[FileChooser]: /api/class-filechooser.mdx "FileChooser"
[Frame]: /api/class-frame.mdx "Frame"
[FrameLocator]: /api/class-framelocator.mdx "FrameLocator"
[GenericAssertions]: /api/class-genericassertions.mdx "GenericAssertions"
[JSHandle]: /api/class-jshandle.mdx "JSHandle"
[Keyboard]: /api/class-keyboard.mdx "Keyboard"
[Locator]: /api/class-locator.mdx "Locator"
[LocatorAssertions]: /api/class-locatorassertions.mdx "LocatorAssertions"
[Logger]: /api/class-logger.mdx "Logger"
[Mouse]: /api/class-mouse.mdx "Mouse"
[Page]: /api/class-page.mdx "Page"
[PageAssertions]: /api/class-pageassertions.mdx "PageAssertions"
[Playwright]: /api/class-playwright.mdx "Playwright"
[PlaywrightAssertions]: /api/class-playwrightassertions.mdx "PlaywrightAssertions"
[Request]: /api/class-request.mdx "Request"
[Response]: /api/class-response.mdx "Response"
[Route]: /api/class-route.mdx "Route"
[Selectors]: /api/class-selectors.mdx "Selectors"
[SnapshotAssertions]: /api/class-snapshotassertions.mdx "SnapshotAssertions"
[TimeoutError]: /api/class-timeouterror.mdx "TimeoutError"
[Touchscreen]: /api/class-touchscreen.mdx "Touchscreen"
[Tracing]: /api/class-tracing.mdx "Tracing"
[Video]: /api/class-video.mdx "Video"
[WebError]: /api/class-weberror.mdx "WebError"
[WebSocket]: /api/class-websocket.mdx "WebSocket"
[WebSocketRoute]: /api/class-websocketroute.mdx "WebSocketRoute"
[Worker]: /api/class-worker.mdx "Worker"
[Fixtures]: /api/class-fixtures.mdx "Fixtures"
[FullConfig]: /api/class-fullconfig.mdx "FullConfig"
[FullProject]: /api/class-fullproject.mdx "FullProject"
[Location]: /api/class-location.mdx "Location"
[Test]: /api/class-test.mdx "Test"
[TestConfig]: /api/class-testconfig.mdx "TestConfig"
[TestInfo]: /api/class-testinfo.mdx "TestInfo"
[TestInfoError]: /api/class-testinfoerror.mdx "TestInfoError"
[TestOptions]: /api/class-testoptions.mdx "TestOptions"
[TestProject]: /api/class-testproject.mdx "TestProject"
[TestStepInfo]: /api/class-teststepinfo.mdx "TestStepInfo"
[WorkerInfo]: /api/class-workerinfo.mdx "WorkerInfo"
[Reporter]: /api/class-reporter.mdx "Reporter"
[Suite]: /api/class-suite.mdx "Suite"
[TestCase]: /api/class-testcase.mdx "TestCase"
[TestError]: /api/class-testerror.mdx "TestError"
[TestResult]: /api/class-testresult.mdx "TestResult"
[TestStep]: /api/class-teststep.mdx "TestStep"
[Element]: https://developer.mozilla.org/en-US/docs/Web/API/element "Element"
[EvaluationArgument]: /evaluating.mdx#evaluation-argument "EvaluationArgument"
[Promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise "Promise"
[iterator]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols "Iterator"
[origin]: https://developer.mozilla.org/en-US/docs/Glossary/Origin "Origin"
[selector]: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors "selector"
[Serializable]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Description "Serializable"
[UIEvent.detail]: https://developer.mozilla.org/en-US/docs/Web/API/UIEvent/detail "UIEvent.detail"
[UnixTime]: https://en.wikipedia.org/wiki/Unix_time "Unix Time"
[xpath]: https://developer.mozilla.org/en-US/docs/Web/XPath "xpath"

[Array]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array "Array"
[boolean]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type "Boolean"
[Buffer]: https://nodejs.org/api/buffer.html#buffer_class_buffer "Buffer"
[ChildProcess]: https://nodejs.org/api/child_process.html "ChildProcess"
[Date]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date "Date"
[Error]: https://nodejs.org/api/errors.html#errors_class_error "Error"
[EventEmitter]: https://nodejs.org/api/events.html#events_class_eventemitter "EventEmitter"
[function]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function "Function"
[FormData]: https://developer.mozilla.org/en-US/docs/Web/API/FormData "FormData"
[Map]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map "Map"
[Metadata]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object "Object&lt;string, any&gt;"
[null]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/null "null"
[number]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type "Number"
[Object]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object "Object"
[Promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise "Promise"
[Readable]: https://nodejs.org/api/stream.html#stream_class_stream_readable "Readable"
[ReadStream]: https://nodejs.org/api/fs.html#class-fsreadstream "ReadStream"
[RegExp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp "RegExp"
[string]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type "string"
[void]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined "void"
[URL]: https://nodejs.org/api/url.html "URL"
[URLSearchParams]: https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams "URLSearchParams"

[all available image tags]: https://mcr.microsoft.com/en-us/product/playwright/about "all available image tags"
[Microsoft Artifact Registry]: https://mcr.microsoft.com/en-us/product/playwright/about "Microsoft Artifact Registry"
[Dockerfile.noble]: https://github.com/microsoft/playwright/blob/main/utils/docker/Dockerfile.noble "Dockerfile.noble"