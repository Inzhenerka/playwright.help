---
id: ci-intro
title: "Настройка CI"
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HTMLCard from '@site/src/components/HTMLCard';

## Введение

Тесты Playwright могут выполняться на любом CI-провайдере. В этом руководстве описан один из способов запуска тестов на GitHub с использованием GitHub Actions. Если вы хотите узнать больше или узнать, как настроить других CI-провайдеров, ознакомьтесь с нашей подробной [документацией по непрерывной интеграции](./ci.mdx).

#### Вы узнаете
- [Как настроить GitHub Actions](/ci-intro.mdx#setting-up-github-actions)
- [Как просмотреть журналы тестов](/ci-intro.mdx#viewing-test-logs)
- [Как просмотреть HTML-отчет](/ci-intro.mdx#viewing-the-html-report)
- [Как просмотреть трассировку](/ci-intro.mdx#viewing-the-trace)
- [Как опубликовать отчет в интернете](/ci-intro.mdx#publishing-report-on-the-web)

## Настройка GitHub Actions

При [установке Playwright](./intro.mdx) с помощью [расширения VS Code](./getting-started-vscode.mdx) или с помощью `npm init playwright@latest` вам будет предложено добавить рабочий процесс [GitHub Actions](https://docs.github.com/en/actions). Это создаст файл `playwright.yml` внутри папки `.github/workflows`, содержащий все необходимое для того, чтобы ваши тесты выполнялись при каждом пуше и пулл-запросе в основную ветку. Вот как выглядит этот файл:

```yml title=".github/workflows/playwright.yml"
name: Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: lts/*
    - name: Установка зависимостей
      run: npm ci
    - name: Установка браузеров Playwright
      run: npx playwright install --with-deps
    - name: Запуск тестов Playwright
      run: npx playwright test
    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30
```

Рабочий процесс выполняет следующие шаги:
1. Клонирует ваш репозиторий 
2. Устанавливает Node.js 
3. Устанавливает зависимости NPM 
4. Устанавливает браузеры Playwright 
5. Запускает тесты Playwright 
6. Загружает HTML-отчет в интерфейс GitHub

Чтобы узнать больше об этом, смотрите ["Понимание GitHub Actions"](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions).

## Создание репозитория и пуш в GitHub

После того как вы настроили [рабочий процесс GitHub Actions](#setting-up-github-actions), вам нужно просто [создать репозиторий на GitHub](https://docs.github.com/en/get-started/quickstart/create-a-repo) или запушить ваш код в существующий репозиторий. Следуйте инструкциям на GitHub и не забудьте [инициализировать git-репозиторий](https://github.com/git-guides/git-init) с помощью команды `git init`, чтобы вы могли [добавлять](https://github.com/git-guides/git-add), [коммитить](https://github.com/git-guides/git-commit) и [пушить](https://github.com/git-guides/git-push) ваш код.

###### 
<img width="861" alt="Создание репозитория и пуш в GitHub" src="https://user-images.githubusercontent.com/13063165/183423254-d2735278-a2ab-4d63-bb99-48d8e5e447bc.png"/>

## Открытие рабочих процессов

Нажмите на вкладку **Actions**, чтобы увидеть рабочие процессы. Здесь вы сможете увидеть, прошли ли ваши тесты или провалились.

###### 
![открытие рабочего процесса](https://user-images.githubusercontent.com/13063165/183423783-58bf2008-514e-4f96-9c12-c9a55703960c.png)

## Просмотр журналов тестов

Нажатие на выполнение рабочего процесса покажет вам все действия, которые выполнил GitHub, а нажатие на **Запуск тестов Playwright** покажет сообщения об ошибках, что ожидалось и что было получено, а также журнал вызовов.

###### 
![Просмотр журналов тестов](https://user-images.githubusercontent.com/13063165/183423783-58bf2008-514e-4f96-9c12-c9a55703960c.png)

## HTML-отчет

HTML-отчет показывает полный отчет о ваших тестах. Вы можете фильтровать отчет по браузерам, пройденным тестам, провалившимся тестам, пропущенным тестам и ненадежным тестам.

### Скачивание HTML-отчета

В разделе Артефакты нажмите на **playwright-report**, чтобы скачать ваш отчет в формате zip-файла.

<img width="972" alt="Скачивание HTML-отчета" src="https://user-images.githubusercontent.com/13063165/183437023-524f1803-84e4-4862-9ce3-1d55af0e023e.png" />

### Просмотр HTML-отчета

Локальное открытие отчета не будет работать должным образом, так как вам нужен веб-сервер, чтобы все работало корректно. Сначала извлеките zip, желательно в папку, где уже установлен Playwright. Используя командную строку, перейдите в директорию, где находится отчет, и используйте `npx playwright show-report`, за которым следует имя извлеченной папки. Это позволит вам просмотреть отчет в вашем браузере.

```bash
npx playwright show-report name-of-my-extracted-playwright-report
```

![просмотр HTML-отчета](https://github.com/microsoft/playwright/assets/13063165/c5f60e56-fb75-4a2d-a4b6-054b8c5d69c1)

Чтобы узнать больше об отчетах, ознакомьтесь с нашей подробной инструкцией по [HTML-репортеру](/test-reporters.mdx#html-reporter).

## Просмотр трассировки

После того как вы обслужили отчет с помощью `npx playwright show-report`, нажмите на значок трассировки рядом с именем файла теста, как показано на изображении выше. Вы сможете просмотреть трассировку ваших тестов и проверить каждое действие, чтобы попытаться выяснить, почему тесты не проходят.

![просмотр трассировки playwright](https://github.com/microsoft/playwright/assets/13063165/10fe3585-8401-4051-b1c2-b2e92ac4c274)

## Публикация отчета в интернете

Скачивание HTML-отчета в виде zip-файла не очень удобно. Однако мы можем использовать возможности хостинга статических веб-сайтов Azure Storage, чтобы легко и эффективно обслуживать HTML-отчеты в Интернете, требуя минимальной настройки.
1. Создайте [учетную запись Azure Storage](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-create).
1. Включите [Хостинг статического веб-сайта](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to#enable-static-website-hosting) для учетной записи хранения.
1. Создайте сервисный принципал в Azure и предоставьте ему доступ к Azure Blob Storage. После успешного выполнения команда отобразит учетные данные, которые будут использоваться на следующем шаге.
   
   ```bash
   az ad sp create-for-rbac --name "github-actions" --role "Storage Blob Data Contributor" --scopes /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.Storage/storageAccounts/<STORAGE_ACCOUNT_NAME>
   ```
   
1. Используйте учетные данные с предыдущего шага для настройки зашифрованных секретов в вашем репозитории GitHub. Перейдите в настройки вашего репозитория, в разделе [секреты GitHub Actions](https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository) и добавьте следующие секреты:
   - `AZCOPY_SPA_APPLICATION_ID`
   - `AZCOPY_SPA_CLIENT_SECRET`
   - `AZCOPY_TENANT_ID`
   
   Для подробной инструкции о том, как авторизовать сервисный принципал с помощью клиентского секрета, обратитесь к [этой документации Microsoft](https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-authorize-azure-active-directory#authorize-a-service-principal-by-using-a-client-secret-1).
1. Добавьте шаг, который загружает HTML-отчет в Azure Storage.
   
   ```yaml title=".github/workflows/playwright.yml"
   ...
       - name: Загрузка HTML-отчета в Azure
         shell: bash
         run: |
           REPORT_DIR='run-${{ github.run_id }}-${{ github.run_attempt }}'
           azcopy cp --recursive "./playwright-report/*" "https://<STORAGE_ACCOUNT_NAME>.blob.core.windows.net/\$web/$REPORT_DIR"
           echo "::notice title=HTML report url::https://<STORAGE_ACCOUNT_NAME>.z1.web.core.windows.net/$REPORT_DIR/index.html"
         env:
           AZCOPY_AUTO_LOGIN_TYPE: SPN
           AZCOPY_SPA_APPLICATION_ID: '${{ secrets.AZCOPY_SPA_APPLICATION_ID }}'
           AZCOPY_SPA_CLIENT_SECRET: '${{ secrets.AZCOPY_SPA_CLIENT_SECRET }}'
           AZCOPY_TENANT_ID: '${{ secrets.AZCOPY_TENANT_ID }}'
   ```
   
Содержимое контейнера хранения `$web` можно получить из браузера, используя [публичный URL](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to?tabs=azure-portal#portal-find-url) веб-сайта.

:::note

Этот шаг не будет работать для пулл-запросов, созданных из форкнутого репозитория, так как такой рабочий процесс [не имеет доступа к секретам](https://docs.github.com/en/actions/security-guides/encrypted-secrets#using-encrypted-secrets-in-a-workflow).
:::

## Что дальше
- [Узнайте, как использовать локаторы](./locators.mdx)
- [Узнайте, как выполнять действия](./input.mdx)
- [Узнайте, как писать утверждения](./test-assertions.mdx)
- [Узнайте больше о просмотрщике трассировок](/trace-viewer.mdx)
- [Узнайте больше о способах запуска тестов на GitHub Actions](/ci.mdx#github-actions)
- [Узнайте больше о запуске тестов на других CI-провайдерах](/ci.mdx)